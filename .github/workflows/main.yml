name: Build WinDeck Nexus

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup MSVC Developer Environment
        uses: ilammy/msvc-dev-cmd@v1
        with:
          arch: x86

      - name: Compile Resources
        run: rc.exe resources.rc
        shell: cmd

      # --- NEW DEBUGGING STEP ---
      # This step will print the contents of the LIB variable.
      - name: Display Environment Variables
        run: |
          echo "LIB variable is:"
          echo "%LIB%"
        shell: cmd

      - name: Compile and Link with Clang
        run: |
          clang-cl.exe WinDeck-Nexus.cpp resources.res /std:c++17 /EHsc /D UNICODE /D _UNICODE /I"WebView2SDK\build\native\include" /link /LIBPATH:"WebView2SDK\build\native\x86" user32.lib shellapi.lib gdi32.lib XInput.lib advapi32.lib WebView2Loader.dll.lib /SUBSYSTEM:WINDOWS
        shell: cmd
      
      - name: Upload Build Artifact
        uses: actions/upload-artifact@v4
        with:
          name: WinDeck-Nexus-Build
          path: |
            WinDeck-Nexus.exe
            WebView2SDK/build/native/x86/WebView2Loader.dll
